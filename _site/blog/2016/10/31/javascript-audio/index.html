<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      Generate Notes Programmatically With Javascript
    </title>
    <meta name="description" content="">
    <meta name="author" content="Marc G Gauthier">
    <meta content='user-scalable=no, width=device-width, initial-scale=1.0' name='viewport'>
    <meta name="google-site-verification" content="x2EpQdOMz-k9fP8hak9I3COaXhnQ4jNLp2GU4GYQ8jM" />
    <link href='//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,700italic,400,700,300' rel='stylesheet' type='text/css'>
    <link href="/assets/css/app.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/atom.xml" rel="alternate" type="application/atom+xml" title="Marcgg#Blog">
    <link rel="shortcut icon" href="/assets/favicon.png">
  </head>

  <body>
    <div id="gradient"></div>
    <header>

      <div id="logo">
        <a id='logo1' href="/">marcgg</a>
        <span id='logo2'>#</span>
        <a id='logo3' href="/blog/">
          blog
        </a>
      </div>
      <div id="more-nav">
        &rarr; <a href="/blog/" class="selected">blog</a>
        &rarr; <a href="/photos/" class="">photos</a>
        &rarr; <a href="/books/" class="">books</a>
        &rarr; <a href="/hire/" class="">hire me</a>
      </div>
    </header>

    <h1>
  <span>
    
      Generate Notes Programmatically With Javascript
    
    
  </span>
</h1>


<div class="published">
  <span>31 October 2016</span>
</div>

<div id="container">
  <div id="content">
    <div class="post" id="post-">

      <script src="/assets/js/posts/music.js"></script>

<p>During a recent hackathon, I decided to build <a href="https://warm-escarpment-32217.herokuapp.com/">a multiplayer 8 bits sequencer</a>, using sounds only generated programatically with the Javascript <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API">Web Audio API</a>. The first thing I discovered in the process is that getting the right kind of sound using the Web Audio API is not straightforward at all, especially if you only have a basic musical background like myself.</p>

<p>Let’s say you want to have a clear, ringing and nice sounding note, how exactly should you do it?</p>

<h2 id="simple-beep">Simple Beep</h2>

<p>First let’s create a very basic beep using a <a href="https://en.wikipedia.org/wiki/Sine_wave">sinusoid</a>:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AudioContext</span><span class="p">()</span>
<span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">createOscillator</span><span class="p">()</span>
<span class="nx">o</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">"sine"</span>
<span class="nx">o</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">destination</span><span class="p">)</span>
<span class="nx">o</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span></code></pre></figure>

<p><a href="#" class="js_play_sound" data-source="example1()">Play</a>
<a href="#" class="js_stop_sound">Stop</a></p>

<p>The sound is not great, it seems like you let a phone off the hook. Also, when you stop it, you hear a “click” and it’s not pleasant at all. This is because the human hear reacts this way. This <a href="http://alemangui.github.io/blog//2015/12/26/ramp-to-value.html">great article</a> goes more in depth on the topic, but basically when you stop the sound anywhere else than the zero crossing point, you’ll hear this clicking sound.</p>

<div class="image-wrapper" style="text-align: center"><img src="/assets/blog/audio_click.jpg" alt="Clicking noise on a sine curve" style="padding: 20px; width: 600px;" /></div>

<h2 id="getting-rid-of-the-clicking-sound">Getting Rid Of The Clicking Sound</h2>

<p>The best solution to get rid of this click is to ramp the sine wave down with an exponentional function, using <code class="highlighter-rouge">AudioParam.exponentialRampToValueAtTime()</code> as <a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/exponentialRampToValueAtTime">documented here</a>.</p>

<p>First we start the sound this time adding a <a href="https://developer.mozilla.org/en-US/docs/Web/API/GainNode">gain node</a> to be able to change its value later on.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AudioContext</span><span class="p">()</span>
<span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">createOscillator</span><span class="p">()</span>
<span class="kd">var</span>  <span class="nx">g</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">createGain</span><span class="p">()</span>
<span class="nx">o</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">g</span><span class="p">)</span>
<span class="nx">g</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">destination</span><span class="p">)</span>
<span class="nx">o</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></code></pre></figure>

<p><a href="#" class="js_play_sound" data-source="example2()">Play</a></p>

<p>Then we stop the sound:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">g</span><span class="p">.</span><span class="nx">gain</span><span class="p">.</span><span class="nx">exponentialRampToValueAtTime</span><span class="p">(</span>
  <span class="mf">0.00001</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">+</span> <span class="mf">0.04</span>
<span class="p">)</span></code></pre></figure>

<p><a href="#" class="js_play_sound" data-source="example2Stop(0.04)">Stop</a></p>

<p><em>Note that we don’t ramp down to 0 since there is a limitation in this function where the value has to be positive. We also don’t need to specify that we’re using a sine since it’s the default for any oscilator.</em></p>

<p>As you can hear, the clicking sound is gone! But that’s not the only interesting thing that you can do with this exponential ramp down.</p>

<h2 id="set-a-ringing-noise">Set A Ringing Noise</h2>

<p>In the example above, we decided to stop the sound really quickly, in <code class="highlighter-rouge">0.04</code> seconds. But what happens when we change this <code class="highlighter-rouge">X</code> value?</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">g</span><span class="p">.</span><span class="nx">gain</span><span class="p">.</span><span class="nx">exponentialRampToValueAtTime</span><span class="p">(</span><span class="mf">0.00001</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">+</span> <span class="nx">X</span><span class="p">)</span></code></pre></figure>

<p><a href="#" class="js_play_sound" data-source="example2()">Play</a>
<a href="#" class="js_play_sound" data-source="example2Stop(0.1)">Stop (X=0.1)</a>
<a href="#" class="js_play_sound" data-source="example2Stop(1)">Stop (X=1)</a>
<a href="#" class="js_play_sound" data-source="example2Stop(5)">Stop (X=5)</a></p>

<h3 id="hitting-notes">Hitting Notes</h3>

<p>Giving more time to the sound to fade out gives it a totally different feel. It gets more visible when we start and stop the signal right away:</p>

<p><a href="#" class="js_play_sound" data-source="example3('sine', 0.08)">Start and stop quickly</a>
<a href="#" class="js_play_sound" data-source="example3('sine', 1.5)">Start and stop slowly</a></p>

<p>The first one sounds like a ticking noise when the other sounds like an actual note played on an instrument.</p>

<h3 id="various-oscilators">Various Oscilators</h3>

<p>So far we’ve been using a sine wave for our main signal, but we have other options:</p>

<div class="image-wrapper" style="text-align: center"><img src="/assets/blog/signals.png" alt="Types of oscilators" style="padding: 20px; width: 400px;" /></div>

<p>It’s enven more interesting when we start playing around with the type of oscilators by setting <code class="highlighter-rouge">o.type = type</code>.</p>

<p><a href="#" class="js_play_sound" data-source="example3('sine', 1.5)">Sine</a>
<a href="#" class="js_play_sound" data-source="example3('square', 1.5)">Square</a>
<a href="#" class="js_play_sound" data-source="example3('triangle', 1.5)">Triangle</a>
<a href="#" class="js_play_sound" data-source="example3('sawtooth', 1.5)">Sawtooth</a></p>

<h2 id="play-actual-notes">Play Actual Notes</h2>

<p>With the previous code, it becomes fairly simple to have a nice sounding note, but what exactly were we playing? That’s when you have to take frequency into account. For instance, the one people know is that A4 is 440Hz, but there are others as explained on <a href="https://www.seventhstring.com/resources/notefrequencies.html">this table</a>:</p>

<div class="image-wrapper" style="text-align: center"><img src="/assets/blog/notes.jpg" alt="Notes" style="padding: 20px; width: 500px;" /></div>

<p>To implement it, we just need to add a frequency to our oscilator:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">frequency</span> <span class="o">=</span> <span class="mf">440.0</span>
<span class="nx">o</span><span class="p">.</span><span class="nx">frequency</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">frequency</span></code></pre></figure>

<p>If we change with the value of <code class="highlighter-rouge">frequency</code>, we can play any note. For instance:</p>

<p><a href="#" class="js_play_sound" data-source="example4(261.6, 'sine')">261.6Hz (C4)</a>
<a href="#" class="js_play_sound" data-source="example4(440.0, 'sine')">440Hz (A4)</a>
<a href="#" class="js_play_sound" data-source="example4(830.6, 'sine')">830.6Hz (G#5)</a></p>

<p>Mix this with the ramp down timings and different signals, and you start to be able to create all kinds of interesting sounds.</p>

<p><a href="#" class="js_play_sound" data-source="example4(261.6, 'square')">174.6Hz (F3) - Square</a>
<a href="#" class="js_play_sound" data-source="example4(1109, 'sawtooth')">1109Hz (C#6) - Sawtooth</a>
<a href="#" class="js_play_sound" data-source="example4(87.31, 'triangle')">87.31 Hz (F2) - Triangle</a></p>



      <div id="more">
        
        

        <div id="more-articles">
          
            <p>Since you scrolled this far, you might be interested in some other things I wrote!</p>
            <ul>
              
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
              <li><a href="/blog/2016/03/14/github-pages-jekyll/">Trailing Slashes, Github Pages, Jekyll 3 & 404s</a></li>
            
          
            
          
            
              
              <li><a href="/blog/2016/03/01/vimrc-example/">Vim Configuration From Scratch in 2016</a></li>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
              <li><a href="/blog/2014/07/22/in-defense-of-legacy-code/">Some Respect For Legacy Code</a></li>
            
          
            
          
            
              
              <li><a href="/blog/2014/04/28/frame-based-layout-bad-code/">Tips on Creating a Website From When I Was 12</a></li>
            
          
            
          
            
          
            
              
              <li><a href="/blog/2013/11/05/enough-with-the-language-trolls/">Enough With The Trolls</a></li>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
              <li><a href="/blog/2013/03/25/please-changelog-open-source/">Please Keep a Changelog For Your Open Source Lib</a></li>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
              <li><a href="/blog/2012/09/04/one-reason-to-switch-to-vim-editor/">The One Thing That Made Me Switch To Vim</a></li>
            
          
            
          
            
          
            
          
        
              <li><a href="/books/">Startup & Tech Book Reviews</a>
            </ul>
          
        </div>
        <a href="https://twitter.com/marcgg" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @marcgg</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        <a href="https://twitter.com/share" class="twitter-share-button" data-via="marcgg" data-size="large">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

      </div>

      <div id="comments">
        <style id="disqus_hide">
          #disqus_thread{
            display: none;
          }
        </style>
        <p>
          <span id="show-disqus-arrow">&rarr; </span>
          <a href="#" id="show-disqus">Read the comments or contribute with your own</a>
        </p>
        <div id="disqus_thread"></div>
      </div>
      <script type="text/javascript">
          var disqus_shortname = 'marcgg';
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>

    </div>

  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="/assets/js/comments.js"></script>


    <footer>
      <div>Website powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a>, hosted on
      <a href="https://github.com/marcgg/marcgg.github.com">Github</a>
      and put together by <a href="http://twitter.com/marcgg">@marcgg</a>.</div>
      <div>All of the <a href="/blog">blog's articles</a> are under
      <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative commons</a> license
      unless stated otherwise. Everything else is &copy;.</div>
    </footer>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-31071519-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </body>
</html>
